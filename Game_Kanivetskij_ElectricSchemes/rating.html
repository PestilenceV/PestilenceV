<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Электрические схемы - Рейтинг</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="rating-container">
        <header class="rating-header">
            <h1>Таблица рейтинга</h1>
            <p>Лучшие результаты игроков</p>
        </header>
        
        <main class="rating-main">
            <div class="rating-table-container">
                <table class="rating-table">
                    <thead>
                        <tr>
                            <th>Место</th>
                            <th>Игрок</th>
                            <th>Баллы</th>
                            <th>Уровень</th>
                            <th>Время</th>
                            <th>Дата</th>
                        </tr>
                    </thead>
                    <tbody id="ratingTableBody">
                    </tbody>
                </table>
            </div>
            
            <footer class="rating-footer">
                <div class="action-buttons">
                    <button id="backToMenuBtn" class="btn-primary">
                        На главную
                    </button>
                    <button id="newGameBtn" class="btn-primary">
                        Новая игра
                    </button>
                    <button id="clearBtn" class="btn-danger">
                        Очистить
                    </button>
                </div>
            </footer>
        </main>
    </div>

    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <h2>Подтверждение</h2>
            <p>Вы уверены, что хотите очистить таблицу рейтинга?</p>
            <div class="modal-actions">
                <button id="confirmYes" class="btn-danger">Да</button>
                <button id="confirmNo" class="btn-secondary">Нет</button>
            </div>
        </div>
    </div>

    <script src="game.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            function loadRatingData() {
                const results = GameStorage.getResults();
                const tbody = document.getElementById('ratingTableBody');
                
                if (!results || results.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6">Нет данных</td></tr>';
                    return;
                }
                
                tbody.innerHTML = '';
                results.forEach((result, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${result.playerName}</td>
                        <td>${result.score}</td>
                        <td>${result.level}</td>
                        <td>${formatTime(result.time)}</td>
                        <td>${new Date(result.date).toLocaleDateString()}</td>
                    `;
                    tbody.appendChild(row);
                });
            }
            
            function formatTime(seconds) {
                const minutes = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${minutes}:${secs.toString().padStart(2, '0')}`;
            }
            
            document.getElementById('backToMenuBtn').addEventListener('click', function() {
                window.location.href = 'index.html';
            });
            
            document.getElementById('newGameBtn').addEventListener('click', function() {
                GameStorage.clearProgress();
                localStorage.removeItem('playerName');
                window.location.href = 'index.html';
            });
            
            document.getElementById('clearBtn').addEventListener('click', function() {
                const modal = document.getElementById('confirmModal');
                modal.style.display = 'flex';
                
                document.getElementById('confirmYes').onclick = function() {
                    GameStorage.clearResults();
                    loadRatingData();
                    modal.style.display = 'none';
                };
                
                document.getElementById('confirmNo').onclick = function() {
                    modal.style.display = 'none';
                };
            });
            
            window.addEventListener('click', function(event) {
                const modal = document.getElementById('confirmModal');
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
            
            loadRatingData();
        });
    </script>
</body>
</html>